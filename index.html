<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß† THE ULTIMATE PASSWORD GAUNTLET</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .saura-status {
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.2em;
            border: 3px solid #ff6b6b;
        }

        .password-container {
            margin-bottom: 30px;
        }

        .password-input {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            border: 3px solid #ddd;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-family: 'Courier New', monospace;
            min-height: 60px;
            resize: vertical;
        }

        .password-input:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 10px rgba(78, 205, 196, 0.3);
        }

        .rules-container {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #eee;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .rule {
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            transition: all 0.3s ease;
            border-left: 4px solid #ddd;
        }

        .rule.active {
            background: linear-gradient(45deg, #ffecd2, #fcb69f);
            border-left-color: #ff8a80;
            transform: translateX(5px);
        }

        .rule.passed {
            background: linear-gradient(45deg, #c3f0ca, #c3f0ca);
            border-left-color: #4caf50;
            opacity: 0.7;
        }

        .rule.failed {
            background: linear-gradient(45deg, #ffcdd2, #ffcdd2);
            border-left-color: #f44336;
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .rule-number {
            font-weight: bold;
            color: #666;
            margin-right: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #eee;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
            width: 0%;
            transition: width 0.5s ease;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(45deg, #a8edea, #fed6e3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .burning-char {
            background: linear-gradient(45deg, #ff4757, #ff6348);
            color: white;
            padding: 2px 4px;
            border-radius: 3px;
            animation: burn 1s infinite alternate;
        }

        @keyframes burn {
            0% { transform: scale(1); }
            100% { transform: scale(1.1); }
        }

        .timer {
            font-size: 1.5em;
            font-weight: bold;
            color: #ff4757;
            text-align: center;
            margin-bottom: 20px;
        }

        .final-challenge {
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            border: 3px solid #ff6b6b;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .city-image {
            max-width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 10px;
            margin: 15px 0;
        }

        .hidden {
            display: none;
        }

        .emoji-large {
            font-size: 2em;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .category-header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 20px 0 10px 0;
            font-weight: bold;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† THE ULTIMATE PASSWORD GAUNTLET</h1>
            <p>B·∫£n Si√™u C·∫•p - 64 Quy Lu·∫≠t Th·ª≠ Th√°ch</p>
        </div>

        <div class="saura-status" id="sauraStatus">
            <span class="emoji-large">ü•ö</span>
            <div>Saura ƒëang ch·ªù ƒë∆∞·ª£c t·∫°o ra... (G√µ emoji ü•ö trong m·∫≠t kh·∫©u)</div>
        </div>

        <div class="timer" id="timer">Th·ªùi gian: 00:00</div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div>Quy lu·∫≠t hi·ªán t·∫°i</div>
                <div id="currentRule">1</div>
            </div>
            <div class="stat-card">
                <div>Quy lu·∫≠t ƒë√£ v∆∞·ª£t qua</div>
                <div id="passedRules">0</div>
            </div>
            <div class="stat-card">
                <div>ƒêi·ªÉm Saura</div>
                <div id="sauraScore">0</div>
            </div>
            <div class="stat-card">
                <div>ƒê·ªô d√†i m·∫≠t kh·∫©u</div>
                <div id="passwordLength">0</div>
            </div>
        </div>

        <div class="password-container">
            <textarea 
                id="passwordInput" 
                class="password-input" 
                placeholder="B·∫Øt ƒë·∫ßu nh·∫≠p m·∫≠t kh·∫©u c·ªßa b·∫°n..."
                spellcheck="false"
            ></textarea>
        </div>

        <div class="rules-container" id="rulesContainer">
            <!-- Rules s·∫Ω ƒë∆∞·ª£c t·∫°o ƒë·ªông b·∫±ng JavaScript -->
        </div>

        <div class="final-challenge hidden" id="finalChallenge">
            <h3>üèÜ TH·ª¨ TH√ÅCH CU·ªêI C√ôNG</h3>
            <p>ƒêo√°n th√†nh ph·ªë trong h√¨nh ·∫£nh n√†y:</p>
            <img class="city-image" id="cityImage" src="" alt="Th√†nh ph·ªë b√≠ ·∫©n">
            <input type="text" id="cityGuess" placeholder="Nh·∫≠p t√™n th√†nh ph·ªë...">
            <button onclick="checkCityGuess()">X√°c nh·∫≠n</button>
        </div>
    </div>

    <script>
        class UltimatePasswordGame {
            constructor() {
                this.currentRule = 1;
                this.passedRules = 0;
                this.password = '';
                this.gameStartTime = Date.now();
                this.saura = {
                    state: 'egg', // egg, baby, adult
                    happiness: 100,
                    lastFed: Date.now(),
                    cryCount: 0,
                    sleeping: false
                };
                this.burnSystem = {
                    active: false,
                    burningChars: new Set(),
                    lastBurn: Date.now()
                };
                this.timer = null;
                this.rules = this.generateRules();
                this.cities = [
                    {name: 'Paris', image: 'https://via.placeholder.com/400x300/FF6B6B/FFFFFF?text=Eiffel+Tower'},
                    {name: 'Tokyo', image: 'https://via.placeholder.com/400x300/4ECDC4/FFFFFF?text=Tokyo+Tower'},
                    {name: 'New York', image: 'https://via.placeholder.com/400x300/45B7D1/FFFFFF?text=NYC+Skyline'},
                    {name: 'London', image: 'https://via.placeholder.com/400x300/96CEB4/FFFFFF?text=Big+Ben'},
                    {name: 'Sydney', image: 'https://via.placeholder.com/400x300/FFEAA7/FFFFFF?text=Opera+House'}
                ];
                
                this.init();
            }

            generateRules() {
                return [
                    // C∆† B·∫¢N (1-10)
                    {id: 1, text: "M·∫≠t kh·∫©u ph·∫£i d√†i √≠t nh·∫•t 8 k√Ω t·ª±", category: "C∆† B·∫¢N", check: (pwd) => pwd.length >= 8},
                    {id: 2, text: "Ph·∫£i c√≥ ch·ªØ hoa v√† ch·ªØ th∆∞·ªùng", category: "C∆† B·∫¢N", check: (pwd) => /[a-z]/.test(pwd) && /[A-Z]/.test(pwd)},
                    {id: 3, text: "Ph·∫£i c√≥ √≠t nh·∫•t m·ªôt ch·ªØ s·ªë", category: "C∆† B·∫¢N", check: (pwd) => /\d/.test(pwd)},
                    {id: 4, text: "Ph·∫£i c√≥ m·ªôt k√Ω t·ª± ƒë·∫∑c bi·ªát (!@#$...)", category: "C∆† B·∫¢N", check: (pwd) => /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(pwd)},
                    {id: 5, text: "Kh√¥ng ƒë∆∞·ª£c ch·ª©a t·ª´ 'password'", category: "C∆† B·∫¢N", check: (pwd) => !pwd.toLowerCase().includes('password')},
                    {id: 6, text: "Ph·∫£i c√≥ t√™n m·ªôt lo√†i ƒë·ªông v·∫≠t", category: "C∆† B·∫¢N", check: (pwd) => /cat|dog|lion|tiger|elephant|bird|fish|bear|wolf|fox/i.test(pwd)},
                    {id: 7, text: "T·ªïng c√°c ch·ªØ s·ªë ph·∫£i l√† s·ªë ch·∫µn", category: "C∆† B·∫¢N", check: (pwd) => {
                        const digits = pwd.match(/\d/g);
                        if (!digits) return false;
                        const sum = digits.reduce((acc, digit) => acc + parseInt(digit), 0);
                        return sum % 2 === 0;
                    }},
                    {id: 8, text: "Kh√¥ng ƒë∆∞·ª£c c√≥ hai k√Ω t·ª± tr√πng nhau li√™n ti·∫øp", category: "C∆† B·∫¢N", check: (pwd) => !/(.)\1/.test(pwd)},
                    {id: 9, text: "Ph·∫£i ch·ª©a m·ªôt nguy√™n √¢m k√©p (ae, ou, io...)", category: "C∆† B·∫¢N", check: (pwd) => /ae|ou|io|ea|ai|ei|oo|ee|aa|ii|uu/i.test(pwd)},
                    {id: 10, text: "Ph·∫£i ch·ª©a m·ªôt t·ª´ ti·∫øng Anh vi·∫øt ng∆∞·ª£c", category: "C∆† B·∫¢N", check: (pwd) => /level|civic|radar|madam|refer|stats|noon|deed|racecar/i.test(pwd)},

                    // NG·ªÆ NGHƒ®A & LOGIC (11-20)
                    {id: 11, text: "Ph·∫£i ch·ª©a m·ªôt t√™n m√†u c∆° b·∫£n (red, blue...)", category: "NG·ªÆ NGHƒ®A & LOGIC", check: (pwd) => /red|blue|green|yellow|orange|purple|pink|black|white|brown/i.test(pwd)},
                    {id: 12, text: "Ph·∫£i c√≥ m·ªôt t·ª´ ƒë·ªìng √¢m ti·∫øng Anh (write/right)", category: "NG·ªÆ NGHƒ®A & LOGIC", check: (pwd) => /write|right|there|their|to|too|two|four|for|eight|ate/i.test(pwd)},
                    {id: 13, text: "Kh√¥ng ƒë∆∞·ª£c ch·ª©a hai nguy√™n √¢m ƒë·ª©ng c·∫°nh nhau", category: "NG·ªÆ NGHƒ®A & LOGIC", check: (pwd) => !/[aeiou]{2}/i.test(pwd)},
                    {id: 14, text: "Ph·∫£i c√≥ m·ªôt t·ª´ v·ª±ng GRE c·∫•p ƒë·ªô C2", category: "NG·ªÆ NGHƒ®A & LOGIC", check: (pwd) => /ubiquitous|perspicacious|surreptitious|grandiloquent|obfuscate/i.test(pwd)},
                    {id: 15, text: "Ph·∫£i c√≥ t√™n m·ªôt m√¥n h·ªçc", category: "NG·ªÆ NGHƒ®A & LOGIC", check: (pwd) => /math|science|history|english|biology|chemistry|physics|art|music/i.test(pwd)},
                    {id: 16, text: "Kh√¥ng ƒë∆∞·ª£c b·∫Øt ƒë·∫ßu ho·∫∑c k·∫øt th√∫c b·∫±ng ch·ªØ s·ªë", category: "NG·ªÆ NGHƒ®A & LOGIC", check: (pwd) => !/^\d/.test(pwd) && !/\d$/.test(pwd)},
                    {id: 17, text: "Ph·∫£i c√≥ m·ªôt t·ª´ palindrome (level, civic, radar...)", category: "NG·ªÆ NGHƒ®A & LOGIC", check: (pwd) => /level|civic|radar|madam|refer|stats|noon|deed|racecar/i.test(pwd)},
                    {id: 18, text: "Ph·∫£i c√≥ t·ª´ 3 ng√¥n ng·ªØ kh√°c nhau", category: "NG·ªÆ NGHƒ®A & LOGIC", check: (pwd) => {
                        const english = /hello|world|good|bad/i.test(pwd);
                        const spanish = /hola|mundo|bueno|malo/i.test(pwd);
                        const french = /bonjour|monde|bon|mauvais/i.test(pwd);
                        return [english, spanish, french].filter(Boolean).length >= 3;
                    }},
                    {id: 19, text: "Ph·∫£i c√≥ m·ªôt c·ª•m ·∫©n d·ª• ph·ªï bi·∫øn", category: "NG·ªÆ NGHƒ®A & LOGIC", check: (pwd) => /break.*ice|cold.*feet|piece.*cake|raining.*cats.*dogs/i.test(pwd)},
                    {id: 20, text: "M·∫≠t kh·∫©u ph·∫£i t·∫°o th√†nh m·ªôt c√¢u c√≥ nghƒ©a ƒë·∫ßy ƒë·ªß", category: "NG·ªÆ NGHƒ®A & LOGIC", check: (pwd) => pwd.split(' ').length >= 4 && /[.!?]$/.test(pwd)},

                    // TH·ªúI GIAN & NG·ªÆ C·∫¢NH (21-30)
                    {id: 21, text: "Ph·∫£i ch·ª©a gi·ªù hi·ªán t·∫°i (HH:MM)", category: "TH·ªúI GIAN & NG·ªÆ C·∫¢NH", check: (pwd) => {
                        const now = new Date();
                        const timeStr = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                        return pwd.includes(timeStr);
                    }},
                    {id: 22, text: "Ph·∫£i ch·ª©a ng√†y sinh c·ªßa b·∫°n (DD/MM/YYYY)", category: "TH·ªúI GIAN & NG·ªÆ C·∫¢NH", check: (pwd) => /\d{2}\/\d{2}\/\d{4}/.test(pwd)},
                    {id: 23, text: "Ph·∫£i ch·ª©a m√∫i gi·ªù hi·ªán t·∫°i (UTC+7)", category: "TH·ªúI GIAN & NG·ªÆ C·∫¢NH", check: (pwd) => /UTC\+7|GMT\+7/i.test(pwd)},
                    {id: 24, text: "Ph·∫£i c√≥ m·ªôt m√∫i gi·ªù kh√°c l·ªách ‚â• 5 ti·∫øng", category: "TH·ªúI GIAN & NG·ªÆ C·∫¢NH", check: (pwd) => /UTC-5|UTC\+12|GMT-5|GMT\+12/i.test(pwd)},
                    {id: 25, text: "Ph·∫£i c√≥ t√™n m·ªôt th√†nh ph·ªë ƒëang c√≥ m∆∞a", category: "TH·ªúI GIAN & NG·ªÆ C·∫¢NH", check: (pwd) => /london|seattle|mumbai|singapore/i.test(pwd)},
                    {id: 26, text: "Ph·∫£i c√≥ nhi·ªát ƒë·ªô trung b√¨nh h√¥m nay (¬∞C)", category: "TH·ªúI GIAN & NG·ªÆ C·∫¢NH", check: (pwd) => /\d{1,2}¬∞C/.test(pwd)},
                    {id: 27, text: "Ph·∫£i ch·ª©a m·ªôt URL th·∫≠t c√≥ th·ªÉ click", category: "TH·ªúI GIAN & NG·ªÆ C·∫¢NH", check: (pwd) => /https?:\/\/[^\s]+/.test(pwd)},
                    {id: 28, text: "Ph·∫£i ch·ª©a t√™n m·ªôt nh√¢n v·∫≠t l·ªãch s·ª≠ n·ªïi ti·∫øng", category: "TH·ªúI GIAN & NG·ªÆ C·∫¢NH", check: (pwd) => /napoleon|einstein|lincoln|cleopatra|caesar/i.test(pwd)},
                    {id: 29, text: "Ph·∫£i c√≥ m·ªôt ƒë·ªãa danh √≠t ng∆∞·ªùi bi·∫øt ƒë·∫øn", category: "TH·ªúI GIAN & NG·ªÆ C·∫¢NH", check: (pwd) => /bhutan|madagascar|mongolia|laos|fiji/i.test(pwd)},
                    {id: 30, text: "Ph·∫£i ch·ª©a m·ªôt hashtag ƒëang trending", category: "TH·ªúI GIAN & NG·ªÆ C·∫¢NH", check: (pwd) => /#\w+/.test(pwd)},

                    // SAURA & H√ÄNH VI (31-40)
                    {id: 31, text: "G√µ emoji ü•ö ƒë·ªÉ t·∫°o Saura ‚Äì tr·ª©ng kh·ªßng long", category: "SAURA & H√ÄNH VI", check: (pwd) => pwd.includes('ü•ö')},
                    {id: 32, text: "C·ª© m·ªói 60 gi√¢y, b·∫°n ph·∫£i 'cho ƒÉn' Saura b·∫±ng emoji üçé", category: "SAURA & H√ÄNH VI", check: (pwd) => this.checkSauraFeeding(pwd)},
                    {id: 33, text: "N·∫øu b·ªè qu√™n 2 l·∫ßn, Saura s·∫Ω kh√≥c üò¢ v√† kho√° 3 quy lu·∫≠t ng·∫´u nhi√™n", category: "SAURA & H√ÄNH VI", check: () => this.saura.cryCount < 2},
                    {id: 34, text: "Sau 5 ph√∫t, Saura n·ªü th√†nh kh·ªßng long non ü¶ñ", category: "SAURA & H√ÄNH VI", check: () => this.checkSauraEvolution()},
                    {id: 35, text: "M·ªói 3 lu·∫≠t m·ªõi, Saura ƒë√≤i 'ng·ªß' b·∫±ng emoji üõè", category: "SAURA & H√ÄNH VI", check: (pwd) => this.passedRules % 3 !== 0 || pwd.includes('üõè')},
                    {id: 36, text: "N·∫øu spam k√Ω t·ª± qu√° nhanh, Saura b·ªã cho√°ng üí´", category: "SAURA & H√ÄNH VI", check: () => true},
                    {id: 37, text: "N·∫øu Saura kh√≥c 3 l·∫ßn ‚Üí ph·∫£i nh·∫≠p l·∫°i to√†n b·ªô m·∫≠t kh·∫©u", category: "SAURA & H√ÄNH VI", check: () => this.saura.cryCount < 3},
                    {id: 38, text: "C·∫•m s·ª≠ d·ª•ng emoji l·ª≠a üî• ‚Äì Saura s·ª£ ch√°y n·ªï!", category: "SAURA & H√ÄNH VI", check: (pwd) => !pwd.includes('üî•')},
                    {id: 39, text: "M·ªói l·ªói sai s·∫Ω khi·∫øn Saura 'm·∫•t ni·ªÅm tin üò†'", category: "SAURA & H√ÄNH VI", check: () => this.saura.happiness > 0},
                    {id: 40, text: "N·∫øu gi·ªØ Saura h·∫°nh ph√∫c li√™n t·ª•c 10 lu·∫≠t ‚Üí nh·∫≠n ph·∫ßn th∆∞·ªüng üíé", category: "SAURA & H√ÄNH VI", check: () => this.saura.happiness >= 80},

                    // LOGIC CAO C·∫§P (41-50)
                    {id: 41, text: "T·∫•t c·∫£ c√°c ch·ªØ s·ªë ph·∫£i l√† s·ªë nguy√™n t·ªë (2,3,5,7)", category: "LOGIC CAO C·∫§P", check: (pwd) => {
                        const digits = pwd.match(/\d/g);
                        if (!digits) return false;
                        return digits.every(d => ['2','3','5','7'].includes(d));
                    }},
                    {id: 42, text: "M·ªói t·ª´ ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng ch·ªØ c√°i k·∫ø ti·∫øp trong b·∫£ng ch·ªØ c√°i", category: "LOGIC CAO C·∫§P", check: (pwd) => {
                        const words = pwd.split(/\s+/).filter(w => /^[a-zA-Z]/.test(w));
                        if (words.length < 2) return false;
                        for (let i = 1; i < words.length; i++) {
                            const prevChar = words[i-1][0].toLowerCase();
                            const currChar = words[i][0].toLowerCase();
                            if (currChar.charCodeAt(0) !== prevChar.charCodeAt(0) + 1) return false;
                        }
                        return true;
                    }},
                    {id: 43, text: "Ph·∫£i c√≥ m·ªôt ph∆∞∆°ng tr√¨nh ƒë√∫ng (vd: 3√ó3=9)", category: "LOGIC CAO C·∫§P", check: (pwd) => /\d+[√ó*]\d+=\d+/.test(pwd) && this.checkMathEquation(pwd)},
                    {id: 44, text: "T·ªïng m√£ ASCII c·ªßa to√†n b·ªô m·∫≠t kh·∫©u ph·∫£i l√† b·ªôi s·ªë c·ªßa 100", category: "LOGIC CAO C·∫§P", check: (pwd) => {
                        const sum = pwd.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
                        return sum % 100 === 0;
                    }},
                    {id: 45, text: "Ph·∫£i c√≥ m√£ m√†u hex h·ª£p l·ªá (#a1b2c3)", category: "LOGIC CAO C·∫§P", check: (pwd) => /#[0-9a-fA-F]{6}/.test(pwd)},
                    {id: 46, text: "Ph·∫£i ch·ª©a m·ªôt k√Ω t·ª± Unicode ngo·∫°i ng·ªØ", category: "LOGIC CAO C·∫§P", check: (pwd) => /[Œ±Œ≤Œ≥Œ¥ŒµŒ∂Œ∑Œ∏ŒπŒ∫ŒªŒºŒΩŒæŒøœÄœÅœÉœÑœÖœÜœáœàœâ]|[√±√°√©√≠√≥√∫√º]|[√•√¶√∏√∞√æ]/i.test(pwd)},
                    {id: 47, text: "Kh√¥ng c√≥ hai k√Ω t·ª± c√πng lo·∫°i ·ªü v·ªã tr√≠ l·∫ª", category: "LOGIC CAO C·∫§P", check: (pwd) => this.checkOddPositions(pwd)},
                    {id: 48, text: "M·ªói ch·ªØ c√°i ch·ªâ ƒë∆∞·ª£c d√πng t·ªëi ƒëa 2 l·∫ßn", category: "LOGIC CAO C·∫§P", check: (pwd) => {
                        const letterCount = {};
                        for (let char of pwd.toLowerCase()) {
                            if (/[a-z]/.test(char)) {
                                letterCount[char] = (letterCount[char] || 0) + 1;
                                if (letterCount[char] > 2) return false;
                            }
                        }
                        return true;
                    }},
                    {id: 49, text: "Ph·∫£i c√≥ s·ªë La M√£ nh√¢n l·∫°i b·∫±ng 36 (vd: VI √ó VI)", category: "LOGIC CAO C·∫§P", check: (pwd) => /VI.*VI|XII.*III|XVIII.*II/i.test(pwd)},
                    {id: 50, text: "M·∫≠t kh·∫©u ph·∫£i l√† gi·∫£i ph√°p ·∫©n cho m·ªôt b·∫£ng Sudoku 3√ó3", category: "LOGIC CAO C·∫§P", check: (pwd) => /[1-9]{9}/.test(pwd)},

                    // ƒê·∫∂C BI·ªÜT & T√ÅC GI·∫¢ (51-64)
                    {id: 51, text: "T·ªëi thi·ªÉu 25% k√Ω t·ª± ph·∫£i ƒë∆∞·ª£c vi·∫øt in nghi√™ng", category: "ƒê·∫∂C BI·ªÜT & T√ÅC GI·∫¢", check: (pwd) => true}, // Simplified
                    {id: 52, text: "Kh√¥ng k√Ω t·ª± n√†o trong m·∫≠t kh·∫©u ƒë∆∞·ª£c l·∫∑p l·∫°i t·ª´ quy lu·∫≠t 1-10", category: "ƒê·∫∂C BI·ªÜT & T√ÅC GI·∫¢", check: (pwd) => true}, // Simplified
                    {id: 53, text: "M·∫≠t kh·∫©u ph·∫£i c√≥ ƒë·ªô d√†i ƒë√∫ng b·∫±ng s·ªë tu·ªïi c·ªßa b·∫°n", category: "ƒê·∫∂C BI·ªÜT & T√ÅC GI·∫¢", check: (pwd) => pwd.length >= 18 && pwd.length <= 99},
                    {id: 54, text: "Ph·∫£i c√≥ m·ªôt emoji th·ªÉ hi·ªán t√¢m tr·∫°ng c·ªßa b·∫°n", category: "ƒê·∫∂C BI·ªÜT & T√ÅC GI·∫¢", check: (pwd) => /üòÑ|üò°|üò¢|üòç|üò¥|ü§î|üòé|ü•≥/.test(pwd)},
                    {id: 55, text: "Ph·∫£i c√≥ t√™n m·ªôt ng∆∞·ªùi b·∫°n t·ª´ng l√†m b·∫°n th·∫•t v·ªçng", category: "ƒê·∫∂C BI·ªÜT & T√ÅC GI·∫¢", check: (pwd) => /john|jane|alex|sarah|mike|lisa|david|anna/i.test(pwd)},
                    {id: 56, text: "Ch√®n √≠t nh·∫•t m·ªôt k√Ω t·ª± ƒë·∫∑c bi·ªát kh√¥ng c√≥ tr√™n b√†n ph√≠m", category: "ƒê·∫∂C BI·ªÜT & T√ÅC GI·∫¢", check: (pwd) => /[‚∏ò∆õ»°‚àû‚âà‚â†¬±‚àÜ‚àë‚àè‚àö‚à´Œ©‚àÇ‚àá]/. test(pwd)},
                    {id: 57, text: "C·ª© m·ªói 5 gi√¢y, m·ªôt k√Ω t·ª± trong m·∫≠t kh·∫©u b·ªëc ch√°y üî•", category: "ƒê·∫∂C BI·ªÜT & T√ÅC GI·∫¢", check: () => this.burnSystem.burningChars.size === 0},
                    {id: 58, text: "T·ªïng s·ªë k√Ω t·ª± ph·∫£i chia h·∫øt cho 7", category: "ƒê·∫∂C BI·ªÜT & T√ÅC GI·∫¢", check: (pwd) => pwd.length % 7 === 0},
                    {id: 59, text: "M·ªói 10 gi√¢y, tr√≤ ch∆°i s·∫Ω y√™u c·∫ßu ch√®n m·ªôt emoji ng·∫´u nhi√™n", category: "ƒê·∫∂C BI·ªÜT & T√ÅC GI·∫¢", check: (pwd) => this.checkRandomEmoji(pwd)},
                    {id: 60, text: "Ph·∫£i li·ªát k√™ t√™n 3 sinh v·∫≠t bi·ªÉn kh√¥ng ƒÉn ƒë∆∞·ª£c", category: "ƒê·∫∂C BI·ªÜT & T√ÅC GI·∫¢", check: (pwd) => {
                        const creatures = ['jellyfish', 'pufferfish', 'starfish', 'seaurchin', 'manowar'];
                        const found = creatures.filter(creature => pwd.toLowerCase().includes(creature));
                        return found.length >= 3;
                    }},
                    {id: 61, text: "Ph·∫£i vi·∫øt chu·ªói m√£ Morse ng·∫Øn g·ªìm √≠t nh·∫•t 3 k√Ω t·ª±", category: "ƒê·∫∂C BI·ªÜT & T√ÅC GI·∫¢", check: (pwd) => /[.\-]{3,}/.test(pwd)},
                    {id: 62, text: "Saura y√™u c·∫ßu b·∫°n ch√®n m·ªôt l·ªùi ƒë·ªông vi√™n n√≥ m·ªói 5 lu·∫≠t", category: "ƒê·∫∂C BI·ªÜT & T√ÅC GI·∫¢", check: (pwd) => {
                        if (this.passedRules % 5 === 0 && this.passedRules > 0) {
                            return /c·ªë l√™n saura|you can do it/i.test(pwd);
                        }
                        return true;
                    }},
                    {id: 63, text: "M·∫≠t kh·∫©u PH·∫¢I ch·ª©a t√™n t√°c gi·∫£: MinhSoora", category: "ƒê·∫∂C BI·ªÜT & T√ÅC GI·∫¢", check: (pwd) => pwd.includes('MinhSoora')},
                    {id: 64, text: "TR√í CH∆†I K·∫æT TH√öC: ƒêo√°n th√†nh ph·ªë t·ª´ h√¨nh ·∫£nh v√† g√µ l·∫°i to√†n b·ªô m·∫≠t kh·∫©u trong 90 gi√¢y", category: "ƒê·∫∂C BI·ªÜT & T√ÅC GI·∫¢", check: () => this.currentRule < 64}
                ];
            }

            init() {
                this.renderRules();
                this.setupEventListeners();
                this.startTimer();
                this.startSauraSystem();
                this.startBurnSystem();
            }

            renderRules() {
                const container = document.getElementById('rulesContainer');
                let currentCategory = '';
                
                this.rules.forEach(rule => {
                    if (rule.category !== currentCategory) {
                        currentCategory = rule.category;
                        const categoryHeader = document.createElement('div');
                        categoryHeader.className = 'category-header';
                        categoryHeader.textContent = `üîπ ${currentCategory}`;
                        container.appendChild(categoryHeader);
                    }

                    const ruleElement = document.createElement('div');
                    ruleElement.className = 'rule';
                    ruleElement.id = `rule-${rule.id}`;
                    
                    if (rule.id === this.currentRule) {
                        ruleElement.classList.add('active');
                    }
                    
                    ruleElement.innerHTML = `
                        <span class="rule-number">${rule.id}.</span>
                        ${rule.text}
                    `;
                    
                    container.appendChild(ruleElement);
                });
            }

            setupEventListeners() {
                const passwordInput = document.getElementById('passwordInput');
                let lastInputTime = Date.now();
                let inputSpeed = 0;

                passwordInput.addEventListener('input', (e) => {
                    const currentTime = Date.now();
                    inputSpeed = currentTime - lastInputTime;
                    lastInputTime = currentTime;

                    // Check spam detection
                    if (inputSpeed < 50) { // Very fast typing
                        this.saura.happiness -= 10;
                        this.updateSauraStatus('Saura b·ªã cho√°ng üí´ v√¨ b·∫°n g√µ qu√° nhanh!');
                    }

                    this.password = e.target.value;
                    this.checkRules();
                    this.resetBurningChars();
                });
            }

            checkRules() {
                const currentRuleObj = this.rules[this.currentRule - 1];
                const ruleElement = document.getElementById(`rule-${this.currentRule}`);

                if (currentRuleObj && currentRuleObj.check(this.password)) {
                    ruleElement.classList.remove('active', 'failed');
                    ruleElement.classList.add('passed');
                    this.passedRules++;
                    this.currentRule++;
                    this.saura.happiness = Math.min(100, this.saura.happiness + 5);

                    if (this.currentRule <= 64) {
                        const nextRuleElement = document.getElementById(`rule-${this.currentRule}`);
                        if (nextRuleElement) {
                            nextRuleElement.classList.add('active');
                        }
                    }

                    if (this.currentRule > 64) {
                        this.startFinalChallenge();
                    }
                } else if (ruleElement && !ruleElement.classList.contains('active')) {
                    // Rule failed
                    ruleElement.classList.add('failed');
                    this.saura.happiness = Math.max(0, this.saura.happiness - 5);
                    
                    setTimeout(() => {
                        ruleElement.classList.remove('failed');
                    }, 1000);
                }

                this.updateStats();
                this.updateProgress();
            }

            checkSauraFeeding(pwd) {
                const now = Date.now();
                const timeSinceLastFed = now - this.saura.lastFed;
                
                if (timeSinceLastFed > 60000) { // 60 seconds
                    if (pwd.includes('üçé')) {
                        this.saura.lastFed = now;
                        this.saura.happiness = Math.min(100, this.saura.happiness + 10);
                        return true;
                    } else {
                        this.saura.cryCount++;
                        this.saura.happiness = Math.max(0, this.saura.happiness - 20);
                        this.updateSauraStatus('Saura ƒë√≥i v√† kh√≥c üò¢! Cho n√≥ ƒÉn üçé!');
                        return false;
                    }
                }
                return true;
            }

            checkSauraEvolution() {
                const gameTime = Date.now() - this.gameStartTime;
                if (gameTime > 300000 && this.saura.state === 'egg') { // 5 minutes
                    this.saura.state = 'adult';
                    this.updateSauraStatus('Saura ƒë√£ n·ªü th√†nh kh·ªßng long non ü¶ñ!');
                    return true;
                } else if (gameTime > 150000 && this.saura.state === 'egg') { // 2.5 minutes
                    this.saura.state = 'baby';
                    this.updateSauraStatus('Saura ƒë√£ n·ªü th√†nh kh·ªßng long con üê£!');
                }
                return true;
            }

            checkMathEquation(pwd) {
                const equations = pwd.match(/\d+[√ó*]\d+=\d+/g);
                if (!equations) return false;
                
                return equations.some(eq => {
                    const parts = eq.split(/[√ó*=]/);
                    const a = parseInt(parts[0]);
                    const b = parseInt(parts[1]);
                    const result = parseInt(parts[2]);
                    return a * b === result;
                });
            }

            checkOddPositions(pwd) {
                const oddChars = [];
                for (let i = 0; i < pwd.length; i += 2) {
                    oddChars.push(pwd[i]);
                }
                
                const digitCount = oddChars.filter(c => /\d/.test(c)).length;
                const letterCount = oddChars.filter(c => /[a-zA-Z]/.test(c)).length;
                const specialCount = oddChars.filter(c => /[^a-zA-Z\d]/.test(c)).length;
                
                return digitCount <= 1 && letterCount <= 1 && specialCount <= 1;
            }

            checkRandomEmoji(pwd) {
                // Simplified check - just ensure there are emojis
                return /[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]/u.test(pwd);
            }

            startTimer() {
                const startTime = Date.now();
                this.timer = setInterval(() => {
                    const elapsed = Date.now() - startTime;
                    const minutes = Math.floor(elapsed / 60000);
                    const seconds = Math.floor((elapsed % 60000) / 1000);
                    document.getElementById('timer').textContent = 
                        `Th·ªùi gian: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }, 1000);
            }

            startSauraSystem() {
                setInterval(() => {
                    // Saura happiness decay
                    if (this.saura.happiness > 0) {
                        this.saura.happiness = Math.max(0, this.saura.happiness - 1);
                    }
                    
                    // Check if Saura needs feeding
                    const timeSinceLastFed = Date.now() - this.saura.lastFed;
                    if (timeSinceLastFed > 60000 && !this.password.includes('üçé')) {
                        this.saura.cryCount++;
                        this.updateSauraStatus('Saura ƒë√≥i qu√°! üò¢ Cho n√≥ ƒÉn üçé!');
                    }
                    
                    this.checkSauraEvolution();
                    this.updateSauraDisplay();
                }, 5000);
            }

            startBurnSystem() {
                setInterval(() => {
                    if (this.currentRule >= 57 && this.password.length > 0) {
                        const randomIndex = Math.floor(Math.random() * this.password.length);
                        this.burnSystem.burningChars.add(randomIndex);
                        this.highlightBurningChars();
                    }
                }, 5000);
            }

            highlightBurningChars() {
                const input = document.getElementById('passwordInput');
                let highlightedText = '';
                
                for (let i = 0; i < this.password.length; i++) {
                    if (this.burnSystem.burningChars.has(i)) {
                        highlightedText += `<span class="burning-char">${this.password[i]}</span>`;
                    } else {
                        highlightedText += this.password[i];
                    }
                }
                
                // Note: This is a simplified version - in real implementation,
                // you'd need more complex DOM manipulation for textarea highlighting
            }

            resetBurningChars() {
                if (this.password.includes('üíß')) {
                    this.burnSystem.burningChars.clear();
                }
            }

            updateSauraStatus(message) {
                const status = document.getElementById('sauraStatus');
                let emoji = 'ü•ö';
                
                if (this.saura.state === 'baby') emoji = 'üê£';
                else if (this.saura.state === 'adult') emoji = 'ü¶ñ';
                
                if (this.saura.happiness < 30) emoji += ' üò¢';
                else if (this.saura.happiness > 80) emoji += ' üòÑ';
                
                status.innerHTML = `
                    <span class="emoji-large">${emoji}</span>
                    <div>${message || this.getSauraMessage()}</div>
                `;
            }

            getSauraMessage() {
                if (this.saura.happiness < 20) return 'Saura r·∫•t bu·ªìn... üò¢';
                if (this.saura.happiness < 50) return 'Saura h∆°i lo l·∫Øng... üòü';
                if (this.saura.happiness > 80) return 'Saura r·∫•t vui! üòÑ';
                return 'Saura ƒëang ·ªïn! üòä';
            }

            updateSauraDisplay() {
                this.updateSauraStatus();
            }

            updateStats() {
                document.getElementById('currentRule').textContent = this.currentRule;
                document.getElementById('passedRules').textContent = this.passedRules;
                document.getElementById('sauraScore').textContent = this.saura.happiness;
                document.getElementById('passwordLength').textContent = this.password.length;
            }

            updateProgress() {
                const progress = (this.passedRules / 64) * 100;
                document.getElementById('progressFill').style.width = `${progress}%`;
            }

            startFinalChallenge() {
                const challenge = document.getElementById('finalChallenge');
                const cityImage = document.getElementById('cityImage');
                
                const randomCity = this.cities[Math.floor(Math.random() * this.cities.length)];
                this.finalCity = randomCity.name;
                cityImage.src = randomCity.image;
                
                challenge.classList.remove('hidden');
                
                // Start 90-second countdown
                let timeLeft = 90;
                const countdown = setInterval(() => {
                    document.getElementById('timer').textContent = `Th·ªùi gian c√≤n l·∫°i: ${timeLeft}s`;
                    timeLeft--;
                    
                    if (timeLeft < 0) {
                        clearInterval(countdown);
                        this.currentRule = 40; // Reset to rule 40
                        challenge.classList.add('hidden');
                        alert('H·∫øt th·ªùi gian! Quay v·ªÅ quy lu·∫≠t 40!');
                    }
                }, 1000);
            }

            checkCityGuess() {
                const guess = document.getElementById('cityGuess').value.toLowerCase();
                const correct = this.finalCity.toLowerCase();
                
                if (guess === correct) {
                    alert('üèÜ CH√öC M·ª™NG! B·∫°n ƒë√£ ho√†n th√†nh THE ULTIMATE PASSWORD GAUNTLET!');
                    clearInterval(this.timer);
                } else {
                    alert('Sai r·ªìi! Quay v·ªÅ quy lu·∫≠t 40!');
                    this.currentRule = 40;
                    document.getElementById('finalChallenge').classList.add('hidden');
                }
            }
        }

        // Global function for final challenge
        function checkCityGuess() {
            if (window.game) {
                window.game.checkCityGuess();
            }
        }

        // Initialize game when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.game = new UltimatePasswordGame();
        });
    </script>
</body>
  </html>
